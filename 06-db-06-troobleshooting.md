# Домашнее задание к занятию 6. «Troubleshooting» - Паромов Роман

## Задача 1

### Перед выполнением задания ознакомьтесь с документацией по администрированию MongoDB.

Пользователь (разработчик) написал в канал поддержки, что у него уже 3 минуты происходит CRUD-операция в 
MongoDB и её нужно прервать.

Вы как инженер поддержки решили произвести эту операцию:

напишите список операций, которые вы будете производить для остановки запроса пользователя;
Вначале следует найти данную операцию - ``` db.currentOp() ```. Далее можно воспользоваться командой ```db.killOp()```, чтобы остановить выполнение команды.

предложите вариант решения проблемы с долгими (зависающими) запросами в MongoDB.
* Начать отлавливать медленные запрос через параметр ```maxTimeMS()```, проанализировать запросы и в дальнейшем оптимизировать. 

## Задача 2

# Перед выполнением задания познакомьтесь с документацией по Redis latency troobleshooting.

Вы запустили инстанс Redis для использования совместно с сервисом, который использует механизм TTL. Причём отношение количества записанных key-value-значений к количеству истёкших значений есть величина постоянная и увеличивается пропорционально количеству реплик сервиса.

При масштабировании сервиса до N реплик вы увидели, что:

сначала происходит рост отношения записанных значений к истекшим,
Redis блокирует операции записи.
Как вы думаете, в чём может быть проблема?
* Если в базе данных есть много-много ключей, срок действия которых истекает в одну и ту же секунду, и они составляют не менее 25% текущей совокупности ключей с установленным сроком действия, Redis может заблокировать, чтобы получить процент ключей, срок действия которых уже истек. ниже 25%. 

## Задача 3

### Вы подняли базу данных MySQL для использования в гис-системе. При росте количества записей в таблицах базы пользователи начали жаловаться на ошибки вида:

InterfaceError: (InterfaceError) 2013: Lost connection to MySQL server during query u'SELECT..... '
Как вы думаете, почему это начало происходить и как локализовать проблему?
Какие пути решения этой проблемы вы можете предложить?
* Проверить размер буфер в ```max_allowed_packet```, при необходимости увеличить.
* Проверить время на соединение в ```connect_timeout```, при неоходимости увеличить.
* Возможно слишком большие запросы и стоить обратить внимание на ```net_read_timeout```.

## Задача 4

### Вы решили перевести гис-систему из задачи 3 на PostgreSQL, так как прочитали в документации, что эта СУБД работает с большим объёмом данных лучше, чем MySQL.

После запуска пользователи начали жаловаться, что СУБД время от времени становится недоступной. В dmesg вы видите, что:

postmaster invoked oom-killer. Как вы думаете, что происходит?
* OOM Killer - процесс, который останавливает приложение при нехватки памяти, что бы избежать сбоев.

Как бы вы решили эту проблему?
* Решить проблему с памятью. Добавить ее. Или ограничить максимальное ее количество для приложений.
* внести изменения в конфигурациионый файл postgresql в : max_connections, shared_buffer, work_mem, effective_cache_size, maintenance_work_mem, max_stack_depth.
